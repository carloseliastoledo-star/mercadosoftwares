datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  directUrl = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum AdminRole {
  admin
  editor
}

model Produto {
  id        String    @id @default(uuid())
  wcProductId Int?     @unique
  nome      String
  nomeEn    String?
  nomeEs    String?
  nomeIt    String?
  nomeFr    String?
  slug      String    @unique
  finalUrl  String?
  descricao String?   @db.Text
  descricaoEn String? @db.Text
  descricaoEs String? @db.Text
  descricaoIt String? @db.Text
  descricaoFr String? @db.Text
  preco     Float
  precoAntigo Float?
  ativo     Boolean   @default(true)
  imagem    String?   // ðŸ‘ˆ NOVO CAMPO
  cardItems String?   @db.Text
  googleAdsConversionLabel    String?
  googleAdsConversionValue    Float?
  googleAdsConversionCurrency String?
  tutorialTitulo    String?
  tutorialTituloEn  String?
  tutorialTituloEs  String?
  tutorialTituloIt  String?
  tutorialTituloFr  String?
  tutorialSubtitulo String?
  tutorialSubtituloEn String?
  tutorialSubtituloEs String?
  tutorialSubtituloIt String?
  tutorialSubtituloFr String?
  tutorialConteudo  String?   @db.Text
  tutorialConteudoEn String?  @db.Text
  tutorialConteudoEs String?  @db.Text
  tutorialConteudoIt String?  @db.Text
  tutorialConteudoFr String?  @db.Text
  criadoEm  DateTime  @default(now()) @db.DateTime(0)
  licencas  Licenca[]
  orders    Order[]
  produtoCategorias ProdutoCategoria[]
  precosLoja ProdutoPrecoLoja[]
  precosMoeda ProdutoPrecoMoeda[]
}


model ProdutoPrecoLoja {
  id         String   @id @default(uuid())
  produtoId  String
  produto    Produto  @relation(fields: [produtoId], references: [id])
  storeSlug  String
  preco      Float
  precoAntigo Float?
  createdAt  DateTime @default(now()) @db.DateTime(0)
  updatedAt  DateTime @updatedAt @db.DateTime(0)

  @@unique([produtoId, storeSlug])
}


model ProdutoPrecoMoeda {
  id         String   @id @default(uuid())
  produtoId  String
  produto    Produto  @relation(fields: [produtoId], references: [id])
  storeSlug  String
  currency   String
  amount     Float
  oldAmount  Float?
  createdAt  DateTime @default(now()) @db.DateTime(0)
  updatedAt  DateTime @updatedAt @db.DateTime(0)

  @@unique([produtoId, storeSlug, currency])
}


model Licenca {
  id          String   @id @default(uuid())
  chave       String
  status      String
  produtoId   String
  produto     Produto  @relation(fields: [produtoId], references: [id])
  storeSlug   String?
  customerId  String?
  customer    Customer? @relation(fields: [customerId], references: [id])
  orderId     String?
  order       Order?    @relation(fields: [orderId], references: [id])
  criadoEm    DateTime @default(now()) @db.DateTime(0)
}

model Customer {
  id        String   @id @default(uuid())
  email     String
  storeSlug String?
  passwordHash String?
  passwordResetTokenHash String?
  passwordResetExpiresAt DateTime? @db.DateTime(0)
  nome      String?
  whatsapp  String?
  wcCustomerId Int?
  cpf       String?
  criadoEm  DateTime @default(now()) @db.DateTime(0)
  orders    Order[]
  licencas  Licenca[]
  wooOrders WooOrder[]

  @@unique([email, storeSlug])
}

model Categoria {
  id       String    @id @default(uuid())
  wcCategoryId Int?   @unique
  nome     String
  slug     String    @unique
  ativo    Boolean   @default(true)
  produtoCategorias ProdutoCategoria[]
}

model ProdutoCategoria {
  produtoId  String
  categoriaId String
  produto    Produto   @relation(fields: [produtoId], references: [id])
  categoria  Categoria @relation(fields: [categoriaId], references: [id])

  @@id([produtoId, categoriaId])
}

model WooImportState {
  key       String   @id
  resource  String
  after     DateTime? @db.DateTime(0)
  nextPage  Int      @default(1)
  done      Boolean  @default(false)
  updatedAt DateTime @updatedAt @db.DateTime(0)
  createdAt DateTime @default(now()) @db.DateTime(0)
}

model WooOrder {
  id         String   @id @default(uuid())
  wcOrderId  Int      @unique
  status     String
  total      Float?
  currency   String?
  criadoEm   DateTime @db.DateTime(0)
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id])
  items      WooOrderItem[]
  createdAt  DateTime @default(now()) @db.DateTime(0)
  updatedAt  DateTime @updatedAt @db.DateTime(0)
}

model WooOrderItem {
  id       String   @id @default(uuid())
  orderId  String
  order    WooOrder @relation(fields: [orderId], references: [id])
  name     String?
  quantity Int?
  total    Float?
}

model Order {
  id                  String   @id @default(uuid())
  numero              Int      @unique @default(autoincrement())
  status              String
  storeSlug            String?
  trafficSourceType   String?
  utmSource           String?
  utmMedium           String?
  utmCampaign         String?
  utmTerm             String?
  utmContent          String?
  gclid               String?
  fbclid              String?
  referrer            String?  @db.Text
  landingPage         String?  @db.Text
  currency            String?
  countryCode         String?
  produtoId            String
  produto              Produto  @relation(fields: [produtoId], references: [id])
  customerId           String
  customer             Customer @relation(fields: [customerId], references: [id])
  cupomId              String?
  cupom                Cupom?   @relation(fields: [cupomId], references: [id])
  subtotalAmount       Float?
  pixDiscountPercent   Int?
  pixDiscountAmount    Float?
  couponCode           String?
  couponPercent        Int?
  couponDiscountAmount Float?
  totalAmount          Float?
  mercadoPagoPaymentId String?  @unique
  mercadoPagoPaymentTypeId String?
  mercadoPagoPaymentMethodId String?
  stripePaymentIntentId String? @unique
  criadoEm             DateTime @default(now()) @db.DateTime(0)
  pagoEm               DateTime? @db.DateTime(0)
  emailEnviadoEm       DateTime? @db.DateTime(0)
  telegramEnviadoEm    DateTime? @db.DateTime(0)
  fulfillmentStatus    String?
  fulfillmentError     String?  @db.Text
  fulfillmentUpdatedAt DateTime? @db.DateTime(0)
  licencas             Licenca[]
}

model Cupom {
  id        String   @id @default(uuid())
  code      String   @unique
  percent   Int
  active    Boolean  @default(true)
  startsAt  DateTime? @db.DateTime(0)
  expiresAt DateTime? @db.DateTime(0)
  maxUses   Int?
  usedCount Int      @default(0)
  createdAt DateTime @default(now()) @db.DateTime(0)
  orders    Order[]
}

model Pagina {
  id          String   @id @default(uuid())
  titulo      String
  slug        String   @unique
  conteudo    String?  @db.Text
  publicado   Boolean  @default(false)
  showInFooter Boolean @default(false)
  footerOrder Int?
  criadoEm    DateTime @default(now()) @db.DateTime(0)
  atualizadoEm DateTime @updatedAt @db.DateTime(0)
}

model BlogPost {
  id           String   @id @default(uuid())
  titulo       String
  slug         String   @unique
  html         String?  @db.Text
  publicado    Boolean  @default(false)
  criadoEm     DateTime @default(now()) @db.DateTime(0)
  atualizadoEm DateTime @updatedAt @db.DateTime(0)
}

model AdminUser {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  role         AdminRole @default(editor)
  createdAt    DateTime  @default(now()) @db.DateTime(0)
}

model SiteSettings {
  id                     String   @id @default(uuid())
  storeSlug               String?  @unique
  googleAnalyticsId       String?
  googleAdsConversionId  String?
  googleAdsConversionLabel String?
  headHtml                String?  @db.Text
  bodyOpenHtml            String?  @db.Text
  bodyCloseHtml           String?  @db.Text
  homeBestSellerSlugs     String?  @db.Text
  homeVideoUrl            String?  @db.Text
  footerPolicyLinks       String?  @db.Text
  createdAt              DateTime @default(now()) @db.DateTime(0)
  updatedAt              DateTime @updatedAt @db.DateTime(0)
}
